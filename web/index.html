<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>StackIQ — Live Quote</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
      :root { --bg:#0b1020; --card:#121a2c; --text:#e9eefc; --muted:#9db0d8; --accent:#4e8cff; --danger:#ff6464; }
      *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 Inter,system-ui,Segoe UI,Roboto}
      .wrap{max-width:1100px;margin:48px auto;padding:0 20px}
      h1{font-size:22px;margin:0 0 16px 0}
      .grid{display:grid;grid-template-columns:1fr 360px;gap:24px}
      .card{background:var(--card);border-radius:16px;padding:18px;box-shadow:0 10px 28px rgba(0,0,0,.25)}
      .row{display:flex;gap:12px;align-items:center}
      input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #24314f;background:#0d1426;color:var(--text)}
      button{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
      .kpi{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:14px}
      .k{background:#0d1426;border:1px solid #24314f;padding:10px;border-radius:12px;height:62px}
      .k small{display:block;color:var(--muted)}
      .k b{font-size:18px}
      .status small{display:block;color:var(--muted)}
      .err{color:var(--danger);font-weight:700;margin-top:8px}
      footer{color:#7e8fb9;text-align:center;margin:26px 0}
      canvas{width:100%;height:160px;background:linear-gradient(180deg,#0e162c,transparent);border-radius:12px;border:1px solid #24314f}
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>StackIQ</h1>
      <div class="grid">
        <div class="card">
          <div class="row">
            <input id="sym" placeholder="AAPL" value="AAPL"/>
            <button id="go">Get Quote</button>
          </div>

          <div class="kpi">
            <div class="k"><small>Session High</small><b id="hi">—</b></div>
            <div class="k"><small>Session Low</small><b id="lo">—</b></div>
            <div class="k"><small>Open</small><b id="op">—</b></div>
            <div class="k"><small>Prev Close</small><b id="pc">—</b></div>
          </div>

          <div style="margin-top:14px"><canvas id="spark"></canvas></div>
          <div id="apiNote" style="margin-top:8px;color:#7e8fb9">API: /quote/{symbol}, /summary/{symbol}</div>
        </div>

        <div class="card status">
          <small>Status</small>
          <div id="statusOk">Loaded.</div>
          <div style="margin-top:6px"><small>Version:</small> <span id="ver">—</span></div>
          <div id="err" class="err" style="display:none"></div>
        </div>
      </div>
      <footer>© 2025 StackIQ · minimal market data UI</footer>
    </div>

    <script>
      const $ = (id) => document.getElementById(id);

      async function ping() {
        try {
          const r = await fetch("/version");
          if (!r.ok) throw new Error("version failed");
          const j = await r.json();
          $("ver").textContent = `${j.app} ${j.version}`;
        } catch {}
      }

      function showErr(msg) {
        const e = $("err");
        e.style.display = "block";
        e.textContent = msg;
      }
      function clearErr() { $("err").style.display = "none"; }

      async function loadQuote() {
        clearErr();
        const raw = $("sym").value.trim() || "AAPL";
        const sym = raw.toUpperCase();

        const r = await fetch(`/quote/${encodeURIComponent(sym)}`);
        if (!r.ok) {
          showErr(`Failed to load quote: /quote/${sym} → ${r.status} ${r.statusText}`);
          ["hi","lo","op","pc"].forEach(id => $(id).textContent = "—");
          draw([0,1,0.5,1.2,0.9,1.4]); // dummy spark
          return;
        }
        const q = await r.json();

        $("hi").textContent = q.high?.toFixed(3) ?? "—";
        $("lo").textContent = q.low?.toFixed(3) ?? "—";
        $("op").textContent = q.open?.toFixed(3) ?? "—";
        $("pc").textContent = q.prev_close?.toFixed(3) ?? "—";

        // quick fake sparkline from OHLC (history mocked)
        draw([q.open, q.low, q.high, q.current, (q.current+q.low)/2, q.high]);
      }

      function draw(data) {
        const c = $("spark");
        const ctx = c.getContext("2d");
        const w = c.width = c.clientWidth;
        const h = c.height = c.clientHeight;
        ctx.clearRect(0,0,w,h);
        if (!data || data.length < 2) return;

        const min = Math.min(...data), max = Math.max(...data);
        const nx = (i) => (i/(data.length-1))*w;
        const ny = (v) => h - ((v-min)/(max-min || 1))*h;

        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(nx(0), ny(data[0]));
        for (let i=1;i<data.length;i++) ctx.lineTo(nx(i), ny(data[i]));
        ctx.strokeStyle = "#4e8cff";
        ctx.stroke();
      }

      $("go").addEventListener("click", loadQuote);
      window.addEventListener("DOMContentLoaded", () => { ping(); loadQuote(); });
    </script>
  </body>
</html>













