<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StackIQ – Live Stocks</title>
  <style>
    :root {
      --bg:#0e0f13; --panel:#1a1d24; --muted:#93a3b2; --txt:#e9edf3; --ok:#35d27d; --err:#ff6b6b; --accent:#3aa0ff;
    }
    body{margin:0;background:var(--bg);color:var(--txt);font:15px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    .wrap{max-width:980px;margin:40px auto;padding:16px}
    h1{font-weight:800;letter-spacing:.3px;text-align:center}
    .status{display:flex;gap:8px;align-items:center;justify-content:center;margin:8px 0 24px}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--ok);box-shadow:0 0 10px var(--ok)}
    .grid{display:grid;grid-template-columns:1fr 0.9fr;gap:28px}
    .card{background:var(--panel);border:1px solid #262b35;border-radius:16px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,.25)}
    .label{color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.08em}
    .k{background:#141722;border:1px solid #272c37;border-radius:12px;padding:10px 12px}
    .k b{display:block;font-size:12px;color:var(--muted);margin-bottom:2px}
    .k span{font-weight:700}
    .row{display:flex;gap:12px;align-items:center}
    input[type=text]{flex:1;background:#0f1119;border:1px solid #243a60;border-radius:10px;padding:10px 12px;color:var(--txt);outline:none}
    button{background:var(--accent);border:none;border-radius:10px;padding:10px 14px;color:#fff;font-weight:700;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    .err{color:var(--err)}
    .ok{color:var(--ok)}
    .wizard h3{margin:6px 0}
    .wizard select,.wizard input[type=number]{width:100%;background:#0f1119;border:1px solid #243a60;border-radius:10px;padding:10px 12px;color:var(--txt);outline:none}
    .pill{display:inline-block;background:#0f1119;border:1px solid #243a60;border-radius:14px;padding:4px 10px;margin-right:6px;color:var(--muted);font-size:12px}
    .quote-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:8px}
    .earn{margin-top:14px}
    .earn div{padding:8px 10px;border-bottom:1px solid #212735}
    canvas{width:100%;height:240px}
    .footer{margin-top:16px;color:#7c8697;font-size:12px;text-align:center}
    @media (max-width:960px){ .grid{grid-template-columns:1fr} }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="wrap">
    <h1>StackIQ</h1>
    <div class="status"><span class="dot"></span> <span>API is live</span></div>

    <div class="grid">
      <!-- LEFT: Controls -->
      <div class="card">
        <div class="label">Enter Stock Ticker</div>
        <div class="row" style="margin-top:8px">
          <input id="symbolInput" type="text" placeholder="AAPL, MSFT, NVDA…" />
          <button id="fetchBtn">Fetch</button>
        </div>
        <div class="wizard" style="margin-top:18px">
          <div class="label">Strategy Wizard</div>
          <h3 class="pill">goal: decide buy / hold / avoid</h3>
          <div style="margin-top:8px">
            <div class="label">Investment Horizon</div>
            <select id="horizon">
              <option value="short">Short (weeks)</option>
              <option value="medium" selected>Medium (months)</option>
              <option value="long">Long (year+)</option>
            </select>
          </div>
          <div style="margin-top:10px">
            <div class="label">Risk Tolerance</div>
            <select id="risk">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
          <div style="margin-top:10px">
            <div class="label">Conviction (0–10)</div>
            <input id="conviction" type="number" min="0" max="10" value="5" />
          </div>
          <div style="margin-top:14px">
            <button id="recBtn">Get Recommendation</button>
          </div>
          <div id="recOut" style="margin-top:10px" class="label">Recommendation: <b id="recText">HOLD</b></div>
        </div>
        <div id="err" class="err" style="margin-top:10px"></div>
      </div>

      <!-- RIGHT: Quote + Chart + Earnings -->
      <div class="card">
        <div class="label">Quote</div>
        <div class="quote-grid">
          <div class="k"><b>Current Price</b><span id="currentPrice">—</span></div>
          <div class="k"><b>Change</b><span id="changePct">—</span></div>
          <div class="k"><b>% Change</b><span id="percentChange">—</span></div>
          <div class="k"><b>Open</b><span id="open">—</span></div>
          <div class="k"><b>High</b><span id="high">—</span></div>
          <div class="k"><b>Low</b><span id="low">—</span></div>
          <div class="k"><b>Prev Close</b><span id="prevClose">—</span></div>
          <div class="k"><b>Volume</b><span id="volume">—</span></div>
        </div>

        <div style="margin-top:16px">
          <canvas id="priceChart"></canvas>
        </div>

        <div class="earn">
          <div class="label">Earnings</div>
          <div id="earningsList"></div>
        </div>
      </div>
    </div>

    <div class="footer">UI runs from /web. Data served by /test/:symbol, /quote/:symbol, /earnings/:symbol, /history/:symbol. Health: /health.</div>
  </div>

<script>
const $ = (id) => document.getElementById(id);
const fmt = (n) => (n==null ? "—" : Number(n).toLocaleString(undefined, {maximumFractionDigits:2}));

const input = $("symbolInput");
const fetchBtn = $("fetchBtn");
const err = $("err");

let chart;
function drawChart(candles) {
  const ctx = $("priceChart").getContext("2d");
  const labels = candles.map(d => new Date(d.t*1000).toLocaleDateString());
  const data = candles.map(d => d.c);
  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [{ label: "Close", data, tension:.25, pointRadius:0 }]
    },
    options: {
      responsive:true,
      maintainAspectRatio:false,
      scales:{ x:{display:false}, y:{display:true} },
      plugins:{ legend:{display:false} }
    }
  });
}

async function load(symbol) {
  err.textContent = "";
  fetchBtn.disabled = true;
  try {
    const r = await fetch(`/test/${encodeURIComponent(symbol)}?pretty=1`);
    if (!r.ok) throw new Error(await r.text());
    const data = await r.json();

    const q = data.quote || {};
    $("currentPrice").textContent = fmt(q.current);
    $("percentChange").textContent = q.percent_change==null ? "—" : `${fmt(q.percent_change)}%`;
    $("open").textContent = fmt(q.open);
    $("high").textContent = fmt(q.high);
    $("low").textContent = fmt(q.low);
    $("prevClose").textContent = fmt(q.prev_close);
    $("changePct").textContent = q.percent_change==null || q.prev_close==null ? "—"
      : fmt(((q.current||0) - (q.prev_close||0)));

    // history chart
    const hist = data.history?.candles || [];
    if (hist.length) drawChart(hist);

    // earnings list
    const e = data.earnings?.items || [];
    const el = $("earningsList");
    el.innerHTML = "";
    for (const row of e) {
      const div = document.createElement("div");
      div.innerHTML = `<b>${row.period}</b> — EPS Actual: <b>${fmt(row.epsActual)}</b>, Estimate: <b>${fmt(row.epsEstimate)}</b> , Surprise: ${fmt(row.surprise)}`;
      el.appendChild(div);
    }
  } catch (e) {
    console.error(e);
    err.textContent = "Failed to load data. " + (""+e).slice(0,160);
  } finally {
    fetchBtn.disabled = false;
  }
}

fetchBtn.addEventListener("click", () => {
  const s = input.value.trim().toUpperCase();
  if (!s) { err.textContent = "Enter a ticker"; return; }
  load(s);
});
input.addEventListener("keydown", (e) => {
  if (e.key === "Enter") fetchBtn.click();
});

// quick demo default
input.value = "AAPL";
</script>
</body>
</html>




