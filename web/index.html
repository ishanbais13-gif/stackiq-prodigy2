<!doctype html>
<html lang="en" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StackIQ ‚Äî Live Quote</title>
  <style>
    /* ---------- Theme tokens (light / dark via [data-theme]) ---------- */
    :root {
      --bg: #f7f7fb;
      --card: #ffffff;
      --text: #0b1020;
      --muted: #6b7280;
      --border: #e7e7f0;
      --brand: #1a57ff;
      --brand-weak: #e6eeff;
      --good: #12b886;
      --bad: #ef4444;
      --shadow: 0 10px 24px rgba(16, 24, 40, 0.08);
      --radius: 14px;
    }
    html[data-theme="dark"] {
      --bg: #0c111b;
      --card: #111827;
      --text: #f2f5f9;
      --muted: #a0aec0;
      --border: #1f2a37;
      --brand: #3b82f6;
      --brand-weak: #0b1d3d;
      --good: #10b981;
      --bad: #f87171;
      --shadow: 0 10px 24px rgba(0,0,0,0.45);
    }

    /* ---------- Base ---------- */
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg); color: var(--text);
    }
    .wrap { max-width: 1140px; margin: 56px auto; padding: 0 24px; }
    header {
      display: flex; align-items: center; justify-content: space-between; margin-bottom: 18px;
    }
    .brand { font-weight: 800; letter-spacing: .2px; }
    .brand span { color: var(--brand); }
    .toolbar { display: flex; gap: 10px; align-items: center; }

    /* ---------- Inputs / buttons ---------- */
    .input {
      width: 420px; max-width: 56vw;
      background: var(--card); color: var(--text);
      border: 1px solid var(--border);
      border-radius: 999px; padding: 12px 16px; outline: none;
      box-shadow: var(--shadow);
    }
    .btn {
      background: var(--brand); color: #fff; border: none; cursor: pointer;
      padding: 12px 16px; border-radius: 999px; font-weight: 600;
      box-shadow: var(--shadow);
    }
    .btn:disabled { opacity: .7; cursor: default; }
    .ghost {
      background: transparent; color: var(--text);
      border: 1px solid var(--border);
    }

    /* ---------- Layout ---------- */
    .grid {
      display: grid; grid-template-columns: 1fr 360px; gap: 18px;
    }
    .card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: var(--radius); box-shadow: var(--shadow);
    }
    .pad { padding: 22px; }
    .muted { color: var(--muted); }

    /* ---------- Quote card ---------- */
    .headline { display:flex; align-items: center; gap: 14px; }
    .symbol { font-size: 32px; font-weight: 800; letter-spacing:.6px; }
    .chip {
      display:inline-flex; align-items:center; gap:6px;
      background: var(--brand-weak); color: var(--good);
      border: 1px solid var(--border); padding: 4px 8px; border-radius: 999px; font-weight:700; font-size:12px;
    }
    .price { font-size: 44px; font-weight: 900; margin: 8px 0 16px; }

    .kgrid {
      display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; margin-top: 6px;
    }
    .kv {
      background: transparent; border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px;
    }
    .k { font-size: 12px; color: var(--muted); }
    .v { font-weight: 800; margin-top: 4px; }

    .api { font-size: 12px; color: var(--muted); border-top: 1px dashed var(--border); margin-top: 14px; padding-top: 12px; }

    /* ---------- Status card ---------- */
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    /* ---------- Footer ---------- */
    footer { text-align: center; color: var(--muted); font-size: 12px; padding: 22px 0 8px; }

    /* Mobile */
    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr; }
      .input { width: 100%; max-width: 100%; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">Stack<span>IQ</span></div>
      <div class="toolbar">
        <input id="ticker" class="input" placeholder="AAPL" value="AAPL" />
        <button id="go" class="btn">Get Quote</button>
        <button id="themeToggle" class="btn ghost" title="Toggle theme">üåô</button>
      </div>
    </header>

    <section class="grid">
      <!-- Quote -->
      <div class="card pad">
        <div class="headline">
          <div class="symbol" id="sym">‚Äî</div>
          <div id="deltaChip" class="chip" style="display:none;">
            <span id="deltaPct">0.00%</span>
          </div>
        </div>
        <div class="price" id="price">‚Äî</div>

        <div class="kgrid">
          <div class="kv"><div class="k">Session High</div><div class="v" id="hi">‚Äî</div></div>
          <div class="kv"><div class="k">Session Low</div><div class="v" id="lo">‚Äî</div></div>
          <div class="kv"><div class="k">Open</div><div class="v" id="open">‚Äî</div></div>
          <div class="kv"><div class="k">Prev Close</div><div class="v" id="pc">‚Äî</div></div>
        </div>

        <div id="summary" class="muted" style="margin-top:14px;">Enter a symbol and hit ‚ÄúGet Quote‚Äù.</div>
        <div class="api">API: <span class="mono">/quote/{symbol}</span>, <span class="mono">/summary/{symbol}</span></div>
      </div>

      <!-- Status -->
      <div class="card pad">
        <h3 style="margin:0 0 12px 0;">Status</h3>
        <div class="muted" id="status">Idle.</div>
        <div class="muted" style="margin-top:12px;">Health: <span id="health">‚Äî</span></div>
        <div class="muted">Version: <span id="version" class="mono">stackiq-web v1.0.0</span></div>
      </div>
    </section>

    <footer>¬© 2025 StackIQ ‚Ä¢ minimal market data UI</footer>
  </div>

  <script>
    // -------------------- THEME TOGGLE --------------------
    const root = document.documentElement;
    const toggleBtn = document.getElementById('themeToggle');

    function applyTheme(theme) {
      // theme: 'light' | 'dark' | 'auto'
      if (theme === 'auto') {
        root.setAttribute('data-theme', window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      } else {
        root.setAttribute('data-theme', theme);
      }
      toggleBtn.textContent = root.getAttribute('data-theme') === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }

    // Load preference or system
    const saved = localStorage.getItem('stackiq-theme') || 'auto';
    applyTheme(saved);

    // Watch system changes when in auto
    if (saved === 'auto') {
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => applyTheme('auto'));
    }

    toggleBtn.addEventListener('click', () => {
      const cur = root.getAttribute('data-theme');
      const next = cur === 'dark' ? 'light' : 'dark';
      localStorage.setItem('stackiq-theme', next);
      applyTheme(next);
    });

    // -------------------- QUOTE LOGIC --------------------
    const $ = (id) => document.getElementById(id);
    const input = $('ticker'), go = $('go');

    function setStatus(msg) { $('status').textContent = msg; }
    function setHealth(ok) { $('health').textContent = ok ? '200 OK' : 'error'; }

    async function fetchJSON(url) {
      const r = await fetch(url, { cache: 'no-store' });
      if (!r.ok) throw new Error(`${url} -> ${r.status}`);
      return r.json();
    }

    function formatPct(x) {
      const sign = x > 0 ? '+' : (x < 0 ? '' : '');
      return `${sign}${x.toFixed(2)}%`;
    }

    async function load(symbol) {
      symbol = (symbol || '').trim().toUpperCase();
      if (!symbol) return;

      setStatus('Loading...');
      go.disabled = true;

      try {
        // Health & version
        const healthP = fetchJSON('/health').then(_=>true).catch(_=>false);
        const versionP = fetchJSON('/version').catch(_=>({app:'stackiq-web',version:'v1.0.0'}));

        // Data
        const [q, s, healthy, ver] = await Promise.all([
          fetchJSON(`/quote/${encodeURIComponent(symbol)}`),
          fetchJSON(`/summary/${encodeURIComponent(symbol)}`),
          healthP,
          versionP
        ]);

        // Fill UI
        $('sym').textContent   = symbol;
        $('price').textContent = (q.current ?? q.c ?? 0).toFixed(3);
        $('hi').textContent    = (q.high ?? q.h ?? 0).toFixed(2);
        $('lo').textContent    = (q.low ?? q.l ?? 0).toFixed(2);
        $('open').textContent  = (q.open ?? q.o ?? 0).toFixed(1);
        $('pc').textContent    = (q.prev_close ?? q.pc ?? 0).toFixed(2);

        const pct = Number(q.percent_change ?? q.dp ?? 0);
        const chip = $('deltaChip'), pctNode = $('deltaPct');
        pctNode.textContent = formatPct(pct);
        chip.style.display = 'inline-flex';
        chip.style.color = pct >= 0 ? 'var(--good)' : 'var(--bad)';

        $('summary').textContent = s.summary || `${symbol}: loaded.`;
        setStatus('Loaded.');
        setHealth(healthy);
        $('version').textContent = `${ver.app || 'stackiq-web'} ${ver.version || 'v1.0.0'}`;
      } catch (err) {
        console.error(err);
        setStatus(String(err.message || err));
        setHealth(false);
      } finally {
        go.disabled = false;
      }
    }

    go.addEventListener('click', () => load(input.value));
    input.addEventListener('keydown', (e) => (e.key === 'Enter') && load(input.value));

    // Initial
    load(input.value || 'AAPL');
  </script>
</body>
</html>








