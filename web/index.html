<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StackIQ â€” Live Quote</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg:#f7f8fb;--card:#ffffff;--text:#14171a;--muted:#54616d;--ring:#e5e7eb;--accent:#2563eb;--good:#16a34a;--bad:#ef4444;--chip:#e9efff;
    }
    [data-theme="dark"]{
      --bg:#0f1720;--card:#121a24;--text:#eef2f7;--muted:#93a1b2;--ring:#223043;--accent:#3b82f6;--good:#22c55e;--bad:#f87171;--chip:#1c2a44;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";}
    .wrap{max-width:1100px;margin:64px auto;padding:0 20px}
    .brand{font-weight:800;letter-spacing:.2px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:28px;margin-top:20px}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;box-shadow:0 8px 24px rgba(0,0,0,.05)}
    .pad{padding:22px}
    .search{display:flex;gap:8px;align-items:center}
    .search input{flex:1;padding:12px 14px;border:1px solid var(--ring);background:transparent;border-radius:999px;color:var(--text);outline:none}
    .btn{padding:10px 14px;border-radius:999px;background:var(--accent);color:#fff;border:none;font-weight:600;cursor:pointer}
    .chip{display:inline-flex;align-items:center;gap:6px;background:var(--chip);padding:6px 10px;border-radius:999px;font-size:12px}
    .kpis{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:16px 0}
    .kpi{border:1px solid var(--ring);border-radius:12px;padding:12px}
    .muted{color:var(--muted)}
    .tabs{display:flex;gap:12px;margin:12px 0}
    .tab{padding:8px 16px;border:1px solid var(--ring);border-radius:999px;background:transparent;color:var(--text);cursor:pointer}
    .tab.active{background:var(--accent);border-color:var(--accent);color:#fff}
    .row{display:flex;justify-content:space-between;align-items:center}
    .toggle{width:28px;height:28px;border-radius:50%;border:1px solid var(--ring);display:inline-grid;place-items:center;background:var(--card);cursor:pointer}
    .error{color:var(--bad);font-weight:600}
    .footer{margin-top:26px;color:var(--muted);font-size:12px;text-align:center}
    @media (max-width:1024px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row">
      <div class="brand">StackIQ</div>
      <div class="toggle" id="themeBtn" title="Toggle theme">ðŸŒ™</div>
    </div>

    <div class="grid">
      <div class="card pad" id="quoteCard">
        <div class="search">
          <input id="symbol" placeholder="AAPL" value="AAPL" />
          <button class="btn" id="go">Get Quote</button>
        </div>

        <div style="margin:14px 0 6px 0">
          <div class="row">
            <div id="title" style="font-size:28px;font-weight:800;letter-spacing:.2px;">â€”</div>
            <div id="changeChip" class="chip muted">â€”</div>
          </div>
          <div id="price" style="font-size:42px;font-weight:800;margin-top:6px;">â€”</div>
        </div>

        <div class="kpis">
          <div class="kpi"><div class="muted" style="font-size:12px">Session High</div><div id="kHigh" style="font-weight:700;margin-top:4px">â€”</div></div>
          <div class="kpi"><div class="muted" style="font-size:12px">Session Low</div><div id="kLow" style="font-weight:700;margin-top:4px">â€”</div></div>
          <div class="kpi"><div class="muted" style="font-size:12px">Open</div><div id="kOpen" style="font-weight:700;margin-top:4px">â€”</div></div>
          <div class="kpi"><div class="muted" style="font-size:12px">Prev Close</div><div id="kPrev" style="font-weight:700;margin-top:4px">â€”</div></div>
        </div>

        <div class="tabs">
          <button class="tab active">1M</button>
          <button class="tab">3M</button>
          <button class="tab">6M</button>
          <button class="tab">1Y</button>
        </div>

        <canvas id="stubChart" height="180" style="width:100%;border:1px solid var(--ring);border-radius:12px;background:transparent"></canvas>

        <div id="apiLine" class="muted" style="margin-top:12px;font-size:12px">
          API: <code>/quote/{symbol}</code>, <code>/summary/{symbol}</code>
        </div>
      </div>

      <div class="card pad">
        <div class="muted" style="font-weight:700;margin-bottom:8px">Status</div>
        <div id="status">Loaded.</div>
        <div class="muted" style="margin-top:8px">Version: <span id="version">â€”</span></div>
        <div id="err" class="error" style="margin-top:10px"></div>
      </div>
    </div>

    <div class="footer">Â© 2025 StackIQ â€¢ minimal market data UI</div>
  </div>

  <script>
    // theme
    (function(){
      const key="stackiq-theme";
      const btn=document.getElementById("themeBtn");
      const root=document.documentElement;
      const set=(t)=>{root.setAttribute("data-theme",t);localStorage.setItem(key,t);btn.textContent=t==="dark"?"â˜€ï¸":"ðŸŒ™"};
      set(localStorage.getItem(key)||"light");
      btn.onclick=()=>set(root.getAttribute("data-theme")==="dark"?"light":"dark");
    })();

    // tiny line stub so the card isnâ€™t empty; not a real chart lib
    (function(){
      const el=document.getElementById("stubChart");
      const ctx=el.getContext("2d");
      const H=el.height, W=el.clientWidth;
      el.width=W;
      function draw(values){
        ctx.clearRect(0,0,W,H);
        const min=Math.min(...values), max=Math.max(...values);
        const scale=(v)=> H-( (v-min)/(max-min||1) )*(H-16)-8;
        ctx.beginPath();
        values.forEach((v,i)=>{
          const x = (W/(values.length-1))*i;
          const y = scale(v);
          if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        });
        ctx.lineWidth=2; ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent'); ctx.stroke();
      }
      // random stub
      draw([5,9,7,6,8,12,10,11,9,8,10,13,12,9]);
      window.__drawStub = draw;
    })();

    async function getJSON(url){
      const r = await fetch(url);
      if(!r.ok) throw new Error(`${r.status} ${r.statusText}`);
      return r.json();
    }

    async function refresh(){
      const sym = (document.getElementById("symbol").value || "AAPL").trim();
      document.getElementById("err").textContent = "";
      try{
        const [q, meta] = await Promise.all([
          getJSON(`/quote/${encodeURIComponent(sym)}`),
          getJSON(`/version`)
        ]);

        // paint
        document.getElementById("version").textContent = `stackiq-web ${meta.version}`;
        document.getElementById("title").textContent = q.symbol;
        document.getElementById("price").textContent = q.current?.toFixed(3);
        document.getElementById("kHigh").textContent = q.high?.toFixed(3);
        document.getElementById("kLow").textContent  = q.low?.toFixed(3);
        document.getElementById("kOpen").textContent = q.open?.toFixed(3);
        document.getElementById("kPrev").textContent = q.prev_close?.toFixed(3);

        const chip = document.getElementById("changeChip");
        const dir = (q.percent_change||0) >= 0 ? "â–²" : "â–¼";
        const color = (q.percent_change||0) >= 0 ? "var(--good)" : "var(--bad)";
        chip.textContent = `${dir} ${q.percent_change?.toFixed(2)}%`;
        chip.style.color = color;

        // simple fake values so the stub chart has a trend close to price
        window.__drawStub([q.open, (q.open+q.low)/2, q.low, (q.low+q.high)/2, q.high, (q.high+q.current)/2, q.current].map(v=>Number(v||0)));
      }catch(e){
        // show version anyway so you can tell the backend is alive
        try{
          const meta = await getJSON(`/version`);
          document.getElementById("version").textContent = `stackiq-web ${meta.version}`;
        }catch(_){}
        document.getElementById("err").textContent = `Failed to load quote: /quote/${sym} â†’ ${e.message}`;
      }
    }

    document.getElementById("go").onclick = refresh;
    document.getElementById("symbol").addEventListener("keydown",(e)=>{if(e.key==="Enter"){refresh();}});
    // initial
    refresh();
  </script>
</body>
</html>











