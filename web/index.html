<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>StackIQ — Live Quote</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      :root{
        --bg:#0b1220; --card:#111a2b; --muted:#7b8aaa; --text:#e9edf5; --accent:#2e65ff;
        --line:#1b2740; --ok:#2dd4bf; --bad:#fb7185;
      }
      :root.light{
        --bg:#f6f7fb; --card:#ffffff; --muted:#6b7280; --text:#0f172a; --accent:#2e65ff;
        --line:#e5e7eb; --ok:#10b981; --bad:#ef4444;
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0; background:var(--bg); color:var(--text);
        font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      }
      .wrap{max-width:1100px; margin:64px auto; padding:0 20px}
      .row{display:grid; grid-template-columns:1fr 360px; gap:28px}
      .h{font-weight:700; letter-spacing:.2px; margin-bottom:18px}
      .card{
        background:var(--card); border:1px solid var(--line); border-radius:16px; box-shadow:0 2px 16px rgba(0,0,0,.15)
      }
      .pad{padding:22px}
      .input{
        width:100%; height:44px; border-radius:999px; border:1px solid var(--line);
        background:transparent; color:var(--text); padding:0 16px 0 14px; outline:none;
      }
      .btn{
        height:44px; padding:0 16px; border-radius:999px; border:0; cursor:pointer; font-weight:600;
        background:var(--accent); color:#fff;
      }
      .head{display:flex; gap:10px; align-items:center}
      .sp{flex:1}
      .pill{font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--line); color:var(--muted)}
      .kgrid{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin:14px 0}
      .k{border:1px solid var(--line); border-radius:12px; padding:12px}
      .k .l{font-size:12px; color:var(--muted)}
      .k .v{margin-top:6px; font-weight:700}
      .tabs{display:flex; gap:12px; margin:12px 0 8px}
      .tab{border:1px solid var(--line); border-radius:999px; padding:8px 18px; cursor:pointer; background:transparent; color:var(--text)}
      .tab.active{background:var(--accent); color:#fff; border-color:transparent}
      .api{font-size:12px; color:var(--muted); margin-top:10px}
      .status .err{color:var(--bad); white-space:pre-wrap}
      .spark{height:220px; border-top:1px solid var(--line); padding-top:12px}
      canvas{width:100%; height:100%}
      .toggle{width:36px; height:36px; border-radius:999px; display:inline-grid; place-items:center; border:1px solid var(--line); background:transparent; color:var(--muted); cursor:pointer}
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="h">StackIQ</div>

      <div class="row">
        <div class="card">
          <div class="pad">
            <div class="head">
              <input id="sym" class="input" placeholder="AAPL" value="AAPL" />
              <button id="go" class="btn">Get Quote</button>
              <span class="sp"></span>
              <button id="theme" class="toggle" title="Toggle theme">☾</button>
            </div>

            <div style="height:8px"></div>

            <div class="head" style="gap:8px">
              <div id="big" class="h" style="font-size:34px; line-height:1">—</div>
              <div id="chip" class="pill">—</div>
            </div>

            <div class="kgrid">
              <div class="k">
                <div class="l">Session High</div>
                <div id="hi" class="v">—</div>
              </div>
              <div class="k">
                <div class="l">Session Low</div>
                <div id="lo" class="v">—</div>
              </div>
              <div class="k">
                <div class="l">Open</div>
                <div id="op" class="v">—</div>
              </div>
              <div class="k">
                <div class="l">Prev Close</div>
                <div id="pc" class="v">—</div>
              </div>
            </div>

            <div class="tabs">
              <button class="tab active" data-range="1m">1M</button>
              <button class="tab" data-range="3m">3M</button>
              <button class="tab" data-range="6m">6M</button>
              <button class="tab" data-range="1y">1Y</button>
            </div>

            <div class="spark"><canvas id="chart"></canvas></div>
            <div class="api">API: <code>/quote/{symbol}</code>, <code>/summary/{symbol}</code> (history mocked for now)</div>
          </div>
        </div>

        <div class="card status">
          <div class="pad">
            <div class="h" style="font-size:18px">Status</div>
            <div id="status">Loaded.</div>
            <div class="pill" id="ver" style="display:inline-block; margin-top:8px">Version: —</div>
            <div id="err" class="err" style="margin-top:12px"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // theme
      const themeBtn = document.getElementById("theme");
      const html = document.documentElement;
      function setTheme(t){ if(t==="light"){ html.classList.add("light"); themeBtn.textContent="☀"; } else { html.classList.remove("light"); themeBtn.textContent="☾"; } localStorage.theme=t;}
      setTheme(localStorage.theme || "dark");
      themeBtn.onclick=()=> setTheme(html.classList.contains("light") ? "dark" : "light");

      // tiny line chart (no deps)
      const ctx = document.getElementById("chart").getContext("2d");
      function draw(values){
        const w = ctx.canvas.width = ctx.canvas.clientWidth;
        const h = ctx.canvas.height = ctx.canvas.clientHeight;
        ctx.clearRect(0,0,w,h);
        if(!values || values.length<2){ return; }
        const min = Math.min(...values), max = Math.max(...values);
        const pad=12;
        ctx.lineWidth=2; ctx.strokeStyle=getComputedStyle(document.documentElement).getPropertyValue('--accent'); ctx.beginPath();
        values.forEach((v,i)=>{
          const x = pad + (i/(values.length-1))*(w-pad*2);
          const y = h - pad - ((v-min)/(max-min || 1))*(h-pad*2);
          if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
        });
        ctx.stroke();
      }
      // mock spark values (UI only)
      function mockSeries(n=32, base=150){ const out=[]; let v=base; for(let i=0;i<n;i++){ v += (Math.random()-.45)*2.5; out.push(+v.toFixed(2)); } return out; }

      // DOM bits
      const $ = id => document.getElementById(id);
      const big=$("big"), chip=$("chip"), hi=$("hi"), lo=$("lo"), op=$("op"), pc=$("pc"), statusEl=$("status"), ver=$("ver"), err=$("err");
      draw(mockSeries());

      async function getJSON(url){
        const r = await fetch(url);
        if(!r.ok) throw new Error(`${url} -> ${r.status} ${r.statusText}`);
        return r.json();
      }

      async function load(){
        err.textContent = "";
        const symbol = $("sym").value.trim().toUpperCase();
        const verData = await getJSON("/version").catch(()=>({version:"-"}));
        ver.textContent = `Version: ${verData.version || "-"}`;

        try{
          const q = await getJSON(`/quote/${symbol}`);
          big.textContent = `${symbol} ${q.current}`;
          const pct = (q.percent_change ?? 0).toFixed(2);
          const up = (q.percent_change ?? 0) >= 0;
          chip.textContent = `${up ? "▲" : "▼"} ${Math.abs(pct)}%`;
          chip.style.borderColor = up ? "var(--ok)" : "var(--bad)";
          chip.style.color = up ? "var(--ok)" : "var(--bad)";
          hi.textContent = q.high; lo.textContent = q.low; op.textContent = q.open; pc.textContent = q.prev_close;
          statusEl.textContent = "Loaded.";
        }catch(e){
          err.textContent = `Failed to load quote: ${e.message}`;
          statusEl.textContent = "Loaded.";
          big.textContent = "—"; chip.textContent = "—"; hi.textContent = "—"; lo.textContent = "—"; op.textContent = "—"; pc.textContent = "—";
        }
        draw(mockSeries());
      }

      $("go").onclick = load;
      document.getElementById("sym").addEventListener("keydown", (e)=>{ if(e.key==="Enter") load(); });
      document.querySelectorAll(".tab").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
          btn.classList.add("active");
          draw(mockSeries());
        });
      });

      // initial
      load();
    </script>
  </body>
</html>












