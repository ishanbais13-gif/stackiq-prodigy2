<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <title>StackIQ — Markets</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --bg:#0b1320;--panel:#111a2e;--muted:#7f8ba6;--text:#e6ecff;
      --brand:#63a3ff;--brand2:#8cb6ff;--ok:#25d0a2;--bad:#f77baa;
      --shadow:0 10px 40px rgba(0,0,0,.45);--r:16px
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif;color:var(--text);
      background:radial-gradient(1200px 700px at 85% 20%,rgba(96,70,255,.20),transparent),
                 radial-gradient(900px 600px at 15% 10%,rgba(74,166,255,.18),transparent),var(--bg)}
    .page{max-width:1120px;margin:36px auto 80px;padding:0 20px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    .logo{width:18px;height:18px;border-radius:6px;background:linear-gradient(135deg,var(--brand),var(--brand2));
      box-shadow:0 6px 20px rgba(106,163,255,.35),inset 0 0 16px rgba(255,255,255,.18)}
    .brand{font-weight:700;font-size:22px;letter-spacing:.2px}
    .sub{font-size:12px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1.15fr .85fr;gap:26px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.015));
      border:1px solid rgba(255,255,255,.06);border-radius:var(--r);box-shadow:var(--shadow)}
    .pad{padding:18px}
    .row{display:flex;align-items:center;gap:10px}
    .grow{flex:1}
    .muted{color:var(--muted)}
    .input{width:100%;height:42px;border-radius:10px;background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);color:var(--text);padding:0 14px;font-size:14px;outline:none}
    .btn{height:42px;padding:0 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;color:#0b1320;
      background:linear-gradient(135deg,var(--brand),var(--brand2));box-shadow:0 6px 22px rgba(106,163,255,.35)}
    .btn-ghost{height:42px;padding:0 12px;border-radius:10px;border:1px solid rgba(255,255,255,.08);
      color:var(--text);background:rgba(255,255,255,.03);cursor:pointer}
    .stats{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:10px}
    @media (max-width:640px){.stats{grid-template-columns:repeat(2,1fr)}}
    .stat{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.06);border-radius:12px;padding:12px}
    .stat .label{font-size:12px;color:var(--muted);margin-bottom:4px}
    .stat .val{font-size:16px;font-weight:700;letter-spacing:.2px}
    .ranges{display:flex;gap:8px;margin:12px 0 2px}
    .chip{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.08);color:var(--text);font-weight:700;font-size:12px;cursor:pointer}
    .chip.active{background:rgba(106,163,255,.14);border-color:rgba(106,163,255,.45);
      box-shadow:inset 0 0 1px rgba(106,163,255,.3)}
    .chart-wrap{margin-top:12px;border-radius:14px;overflow:hidden;border:1px solid rgba(255,255,255,.06);position:relative}
    canvas{display:block;width:100%;height:320px;background:rgba(2,12,30,.45)}
    .tooltip{position:absolute;left:0;top:0;pointer-events:none;padding:6px 8px;font-size:12px;background:#0b1320;
      border:1px solid rgba(255,255,255,.1);border-radius:6px;color:var(--text);box-shadow:0 6px 20px rgba(0,0,0,.35);
      transform:translate(-50%,-120%);white-space:nowrap;display:none}
    .kv{margin-top:8px}.kv .k{font-size:12px;color:var(--muted)}.kv .v{font-size:14px;font-weight:600}
    footer{text-align:center;color:var(--muted);font-size:12px;margin-top:16px}
    .api-note{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px;color:rgba(230,236,255,.6);margin-top:10px}
  </style>
</head>
<body>
<div class="page">
  <header>
    <div class="logo"></div>
    <div class="brand">StackIQ</div>
    <div class="sub">Live quote · summary · chart</div>
  </header>

  <div class="grid">
    <section class="card pad">
      <div class="row" style="gap:8px;">
        <input id="symbolInput" class="input grow" value="AAPL" spellcheck="false"/>
        <button id="goBtn" class="btn">Get Quote</button>
        <button id="refreshBtn" class="btn-ghost">Refresh</button>
      </div>

      <div class="stats">
        <div class="stat"><div class="label">Session High</div><div id="statHigh" class="val">–</div></div>
        <div class="stat"><div class="label">Session Low</div><div id="statLow" class="val">–</div></div>
        <div class="stat"><div class="label">Open</div><div id="statOpen" class="val">–</div></div>
        <div class="stat"><div class="label">Prev Close</div><div id="statClose" class="val">–</div></div>
      </div>

      <div class="ranges">
        <button class="chip active" data-range="1M">1M</button>
        <button class="chip" data-range="3M">3M</button>
        <button class="chip" data-range="6M">6M</button>
        <button class="chip" data-range="1Y">1Y</button>
      </div>

      <div class="chart-wrap">
        <canvas id="chart" width="1000" height="320"></canvas>
        <div id="tip" class="tooltip"></div>
      </div>

      <div class="api-note">Endpoints: <code>/quote/{symbol}</code>, <code>/summary/{symbol}</code>, <code>/history/{symbol}?range=1M</code></div>
    </section>

    <aside class="card pad">
      <div class="muted" style="font-weight:700;margin-bottom:6px">Status</div>
      <div class="kv"><span class="k">State:</span> <span id="state" class="v">Idle</span></div>
      <div class="kv"><span class="k">Version:</span> <span id="version" class="v">–</span></div>
      <div class="kv"><span class="k">Summary:</span> <div id="summary" class="v">–</div></div>
    </aside>
  </div>

  <footer>© 2025 StackIQ</footer>
</div>

<!-- API helper so it works under /web/ -->
<script>
  function api(path){ const base = location.pathname.startsWith("/web") ? "/" : "/"; return base + path.replace(/^\//,""); }
</script>

<script>
const $ = (s)=>document.querySelector(s);
const $$ = (s)=>Array.from(document.querySelectorAll(s));

const els = {
  high: $("#statHigh"), low: $("#statLow"), open: $("#statOpen"), close: $("#statClose"),
  state: $("#state"), version: $("#version"), summary: $("#summary"),
  chart: $("#chart"), tip: $("#tip"), input: $("#symbolInput")
};

async function getJSON(url){
  const r = await fetch(url);
  if(!r.ok) throw new Error(await r.text());
  return await r.json();
}

function setState(t){ els.state.textContent = t; }

async function loadVersion(){
  try{
    const j = await getJSON(api("/version"));
    els.version.textContent = `${j.app} v${j.version}`;
  }catch{ els.version.textContent = "n/a"; }
}

async function loadQuote(sym){
  setState("Loading quote…");
  try{
    const j = await getJSON(api(`/quote/${encodeURIComponent(sym)}`));
    els.high.textContent = (j.high ?? "–");
    els.low.textContent  = (j.low ?? "–");
    els.open.textContent = (j.open ?? "–");
    els.close.textContent= (j.prev_close ?? "–");
    setState("OK");
    return j;
  }catch(e){
    setState("Quote error");
    throw e;
  }
}

async function loadSummary(sym){
  try{
    const j = await getJSON(api(`/summary/${encodeURIComponent(sym)}`));
    els.summary.textContent = j.summary || "–";
  }catch{ els.summary.textContent = "–"; }
}

async function loadHistory(sym, range){
  setState(`Loading ${range}…`);
  try{
    const j = await getJSON(api(`/history/${encodeURIComponent(sym)}?range=${encodeURIComponent(range)}`));
    setState("OK");
    return j.points || [];
  }catch(e){
    setState("History error");
    return [];
  }
}

/* === Canvas chart === */
function drawChart(canvas, points){
  const ctx = canvas.getContext("2d");
  const W = canvas.width, H = canvas.height;
  ctx.clearRect(0,0,W,H);

  if(!points || points.length===0){
    ctx.fillStyle = "rgba(230,236,255,.7)";
    ctx.font = "600 14px Inter, sans-serif";
    ctx.fillText("No data", 16, 24);
    return;
  }

  const vals = points.map(p=>p.c);
  const xs = points.map((_,i)=>i);
  const min = Math.min(...vals), max = Math.max(...vals);
  const pad = 20;
  const x = i => pad + (W - 2*pad) * (i / (points.length-1));
  const y = v => H - pad - (H - 2*pad) * ((v - min) / Math.max(1e-9, (max - min)));

  // grid
  ctx.strokeStyle = "rgba(255,255,255,.06)";
  ctx.lineWidth = 1;
  ctx.beginPath();
  for(let g=0; g<=4; g++){
    const gy = pad + (H - 2*pad) * (g/4);
    ctx.moveTo(pad, gy);
    ctx.lineTo(W-pad, gy);
  }
  ctx.stroke();

  // line
  ctx.lineWidth = 2;
  ctx.strokeStyle = "rgba(140,182,255,.95)";
  ctx.beginPath();
  ctx.moveTo(x(0), y(vals[0]));
  for(let i=1;i<points.length;i++) ctx.lineTo(x(i), y(vals[i]));
  ctx.stroke();

  // filled area
  const grad = ctx.createLinearGradient(0, pad, 0, H-pad);
  grad.addColorStop(0, "rgba(140,182,255,.30)");
  grad.addColorStop(1, "rgba(140,182,255,.02)");
  ctx.fillStyle = grad;
  ctx.lineTo(x(points.length-1), H-pad);
  ctx.lineTo(x(0), H-pad);
  ctx.closePath();
  ctx.fill();

  // y labels
  ctx.fillStyle = "rgba(230,236,255,.70)";
  ctx.font = "12px Inter, sans-serif";
  for(let g=0; g<=4; g++){
    const val = max - (max-min)*(g/4);
    const gy = pad + (H - 2*pad) * (g/4);
    ctx.fillText(val.toFixed(2), W - pad - 60, gy - 4);
  }
}

function attachHover(canvas, tip, points){
  const rectOf = () => canvas.getBoundingClientRect();
  const show = (x,y,txt)=>{ tip.style.display="block"; tip.style.left=`${x}px`; tip.style.top=`${y}px`; tip.textContent=txt; };
  const hide = ()=>{ tip.style.display="none"; };

  canvas.onmousemove = (e)=>{
    if(!points || points.length===0) return hide();
    const rect = rectOf();
    const relX = e.clientX - rect.left;
    const idx = Math.max(0, Math.min(points.length-1, Math.round((relX / rect.width) * (points.length-1))));
    const p = points[idx];

    // position tip a bit above cursor
    show(e.clientX - rect.left, e.clientY - rect.top, `Close: ${(+p.c).toFixed(2)}`);
  };
  canvas.onmouseleave = hide;
}

/* === App wiring === */
let currentRange = "1M";
async function refreshAll(){
  const sym = els.input.value.trim().toUpperCase() || "AAPL";
  await loadQuote(sym);
  await loadSummary(sym);
  const pts = await loadHistory(sym, currentRange);
  drawChart(els.chart, pts);
  attachHover(els.chart, els.tip, pts);
}

function bindUI(){
  $("#goBtn").addEventListener("click", refreshAll);
  $("#refreshBtn").addEventListener("click", refreshAll);
  els.input.addEventListener("keydown", (e)=>{ if(e.key==="Enter") refreshAll(); });

  $$(".chip").forEach(ch=>{
    ch.addEventListener("click", async ()=>{
      $$(".chip").forEach(c=>c.classList.remove("active"));
      ch.classList.add("active");
      currentRange = ch.dataset.range || "1M";
      const sym = els.input.value.trim().toUpperCase() || "AAPL";
      const pts = await loadHistory(sym, currentRange);
      drawChart(els.chart, pts);
      attachHover(els.chart, els.tip, pts);
    });
  });
}

(async function init(){
  bindUI();
  await loadVersion();
  await refreshAll();
})();
</script>
</body>
</html>


















