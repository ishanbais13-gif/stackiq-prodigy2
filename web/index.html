<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>StackIQ — minimal market data UI</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />

<style>
  :root {
    --bg: #0b1320;
    --bg-2: #0f1930;
    --panel: #111a2e;
    --muted: #9fb0d3;
    --text: #e6ecff;
    --brand: #63a3ff;
    --brand-2: #2b6cff;
    --good: #4cd18d;
    --bad: #ff6b6b;
    --shadow: 0 10px 40px rgba(0,0,0,.45);
    --radius: 16px;
    --grid: rgba(255,255,255,.08);
    --chart: #63a3ff;
    --chip: rgba(255,255,255,.08);
    --chip-active: rgba(99,163,255,.18);
    --chip-border: rgba(255,255,255,.08);
    --btn-bg: linear-gradient(135deg, var(--brand), var(--brand-2));
    --btn-text: #081123;
  }
  :root.light {
    --bg: #f2f6ff;
    --bg-2: #e9f0ff;
    --panel: #ffffff;
    --muted: #6b7b9c;
    --text: #0e1b32;
    --brand: #2a60ff;
    --brand-2: #7aa7ff;
    --good: #0e885f;
    --bad: #c0392b;
    --grid: rgba(14,27,50,.08);
    --chart: #2a60ff;
    --chip: rgba(14,27,50,.06);
    --chip-active: rgba(42,96,255,.12);
    --chip-border: rgba(14,27,50,.08);
    --btn-text: #ffffff;
  }

  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0;
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    color: var(--text);
    background:
      radial-gradient(1200px 700px at 85% 20%, rgba(96,70,255,.20), transparent),
      radial-gradient(900px 600px at 15% 10%, rgba(14,160,255,.18), transparent),
      var(--bg);
    transition: background .3s ease, color .3s ease;
  }
  .page { max-width: 1160px; margin: 0 auto; padding: 24px; }
  header { display: flex; align-items: center; gap: 14px; margin-bottom: 18px; }
  .logo-dot {
    width: 18px; height: 18px; border-radius: 6px;
    background: linear-gradient(135deg, var(--brand), var(--brand-2));
    box-shadow: 0 6px 22px rgba(106,163,255,.35), inset 0 0 16px rgba(255,255,255,.18);
  }
  .brand { font-weight: 700; font-size: 20px; letter-spacing: .2px; }
  .subtitle { font-size: 12px; color: var(--muted); margin-left: 6px; }

  .topbar { margin-left: auto; }
  .mode-btn {
    appearance: none; border: 1px solid var(--chip-border); background: var(--chip);
    padding: 8px 12px; border-radius: 999px; color: var(--text); cursor: pointer;
    font-weight: 600; box-shadow: var(--shadow); transition: transform .08s ease, background .2s ease;
  }
  .mode-btn:hover { transform: translateY(-1px); }

  .grid {
    display: grid;
    grid-template-columns: 1.15fr .85fr;
    gap: 26px;
  }
  @media (max-width: 980px) {
    .grid { grid-template-columns: 1fr; }
  }
  .card {
    background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
    border: 1px solid rgba(255,255,255,.06);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }
  .pad { padding: 18px; }
  .row { display: flex; align-items: center; gap: 10px; }
  .grow { flex: 1; }

  .input {
    width: 100%; height: 42px; border-radius: 10px;
    background: rgba(255,255,255,.04);
    border: 1px solid rgba(255,255,255,.10);
    color: var(--text); padding: 0 14px; font-size: 14px; outline: none;
  }
  .btn {
    height: 42px; padding: 0 14px; border-radius: 10px; border: 0; cursor: pointer;
    font-weight: 700; color: var(--btn-text); background: var(--btn-bg);
    box-shadow: 0 6px 22px rgba(106,163,255,.35);
    transition: transform .06s ease, filter .2s ease;
  }
  .btn:hover { transform: translateY(-1px); filter: brightness(1.06); }
  .btn-ghost {
    height: 42px; padding: 0 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,.10);
    color: var(--text); background: rgba(255,255,255,.04); cursor: pointer;
  }

  .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
  @media (max-width: 640px) { .stats { grid-template-columns: repeat(2, 1fr); } }
  .stat { background: rgba(255,255,255,.03); border: 1px solid rgba(255,255,255,.08); border-radius: 12px; padding: 12px; }
  .stat .label { font-size: 12px; color: var(--muted); margin-bottom: 4px; }
  .stat .val { font-size: 16px; font-weight: 700; }

  .ranges { display: flex; gap: 8px; margin: 12px 2px 6px; flex-wrap: wrap; }
  .chip {
    padding: 6px 10px; border-radius: 999px; border: 1px solid var(--chip-border);
    background: var(--chip); color: var(--text); font-weight: 600; font-size: 12px; cursor: pointer;
    transition: background .15s ease, border-color .15s ease, transform .06s ease;
  }
  .chip:hover { transform: translateY(-1px); }
  .chip.active { background: var(--chip-active); border-color: rgba(106,163,255,.45); }

  .legend { display: inline-flex; align-items: center; gap: 6px; font-size: 12px; color: var(--muted); margin: 4px 0 8px; }
  .lg-dot { width: 8px; height: 8px; border-radius: 999px; background: var(--chart); box-shadow: 0 0 0 2px rgba(99,163,255,.25); }

  .chart-wrap { margin-top: 10px; border-radius: 14px; overflow: hidden; border: 1px solid rgba(255,255,255,.06); background: rgba(10,18,30,.45); position: relative; }
  canvas { display: block; width: 100%; height: 340px; }
  .tooltip {
    position: absolute; pointer-events: none; padding: 8px 10px; border-radius: 10px;
    font-size: 12px; background: rgba(17,26,46,.92); color: #dfe9ff; border: 1px solid rgba(255,255,255,.10);
    box-shadow: 0 10px 30px rgba(0,0,0,.35); display: none; white-space: nowrap;
  }

  aside .title { font-weight: 700; }
  .kv { font-size: 12px; color: var(--muted); }
  .kv > span { font-weight: 700; color: var(--text); margin-left: 6px; }

  details.api {
    margin-top: 10px; border: 1px dashed rgba(255,255,255,.15);
    background: rgba(255,255,255,.02); border-radius: 12px; padding: 10px 14px;
  }
  details.api > summary { cursor: pointer; user-select: none; color: var(--muted); font-weight: 600; }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 12px; color: rgba(230,236,255,.8); }

  footer { text-align: center; color: var(--muted); font-size: 12px; margin-top: 16px; }
</style>
</head>
<body>
  <div class="page">
    <header>
      <div class="logo-dot"></div>
      <div class="brand">StackIQ</div>
      <div class="subtitle">Minimal market data UI</div>
      <div class="topbar">
        <button id="modeBtn" class="mode-btn">Dark</button>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: quote + chart -->
      <section class="card pad">
        <div class="row" style="gap:10px;">
          <input id="symbolInput" class="input grow" list="tickerList" value="AAPL" placeholder="Search ticker (AAPL, TSLA, NVDA…)" spellcheck="false" />
          <datalist id="tickerList">
            <option value="AAPL"><option value="MSFT"><option value="NVDA">
            <option value="AMZN"><option value="TSLA"><option value="META">
            <option value="GOOGL"><option value="SOFI"><option value="OPEN">
          </datalist>
          <button id="getBtn" class="btn">Get Quote</button>
          <button id="refreshBtn" class="btn-ghost">Refresh</button>
        </div>

        <div class="stats">
          <div class="stat"><div class="label">Session High</div><div id="statHigh" class="val">–</div></div>
          <div class="stat"><div class="label">Session Low</div><div id="statLow" class="val">–</div></div>
          <div class="stat"><div class="label">Open</div><div id="statOpen" class="val">–</div></div>
          <div class="stat"><div class="label">Prev Close</div><div id="statClose" class="val">–</div></div>
        </div>

        <div class="ranges">
          <button class="chip" data-range="1D">1D</button>
          <button class="chip active" data-range="1M">1M</button>
          <button class="chip" data-range="3M">3M</button>
          <button class="chip" data-range="6M">6M</button>
          <button class="chip" data-range="1Y">1Y</button>
          <button class="chip" data-range="5Y">5Y</button>
        </div>

        <div class="legend"><span class="lg-dot"></span><span id="legendSym">AAPL</span></div>

        <div class="chart-wrap">
          <canvas id="chartCanvas" width="1000" height="340"></canvas>
          <div id="tooltip" class="tooltip"></div>
        </div>

        <details class="api">
          <summary>API docs (endpoints)</summary>
<pre class="mono">
GET /quote/{symbol}
GET /summary/{symbol}
GET /history/{symbol}?range=1D|1M|3M|6M|1Y|5Y
</pre>
        </details>
      </section>

      <!-- RIGHT: status -->
      <aside class="card pad">
        <div class="title">Status</div>
        <div class="kv" style="margin-top:8px">State: <span id="status">Loading…</span></div>
        <div class="kv" style="margin-top:6px">Version: <span id="version" class="mono">—</span></div>

        <div class="title muted" style="margin-top:16px;">Summary</div>
        <div id="summary" style="font-size:13px; line-height:1.5; margin-top:6px; color:#cdd6f4;">—</div>
      </aside>
    </div>

    <footer>© 2025 StackIQ</footer>
  </div>

<script>
  // ---------- Helpers ----------
  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));
  const fmt = (n) => (n === null || n === undefined || isNaN(n)) ? '–' : Number(n).toFixed(2);
  const fmtDate = (ts) => {
    const d = new Date(ts * 1000);
    // e.g. "Aug 06, 25"
    return d.toLocaleDateString(undefined, { month: 'short', day: '2-digit', year: '2-digit' });
  };
  const fmtShortDate = (ts) => {
    const d = new Date(ts * 1000);
    return d.toLocaleDateString(undefined, { month: 'short', day: '2-digit' });
  };
  // builds relative API URL (works on root or under /web/)
  function api(path) {
    const base = location.pathname.startsWith("/web") ? "/" : "/";
    return base + path.replace(/^\//, "");
  }

  // ---------- Elements ----------
  const statHigh = $('#statHigh');
  const statLow  = $('#statLow');
  const statOpen = $('#statOpen');
  const statClose= $('#statClose');

  const statusEl = $('#status');
  const versionEl= $('#version');
  const summaryEl= $('#summary');

  const symbolInput = $('#symbolInput');
  const getBtn      = $('#getBtn');
  const refreshBtn  = $('#refreshBtn');
  const legendSym   = $('#legendSym');

  const modeBtn     = $('#modeBtn');

  const canvas = $('#chartCanvas');
  const ctx     = canvas.getContext('2d', { alpha: true });
  const tooltip = $('#tooltip');

  let activeRange = '1M';
  let chartCache  = null; // last computed geometry for hover
  let theme       = localStorage.getItem('siq-theme') || 'dark';

  // ---------- Theme ----------
  function applyTheme(next) {
    theme = next;
    if (theme === 'light') {
      document.documentElement.classList.add('light');
      modeBtn.textContent = 'Light';
    } else {
      document.documentElement.classList.remove('light');
      modeBtn.textContent = 'Dark';
    }
    localStorage.setItem('siq-theme', theme);
    drawLineChart(chartDataPoints || []); // repaint with themed colors
  }
  modeBtn.addEventListener('click', () => applyTheme(theme === 'light' ? 'dark' : 'light'));
  applyTheme(theme);

  // ---------- State ----------
  let chartDataPoints = []; // [{t: epochSec, p: price}, …]
  let animReq = 0;

  // ---------- API ----------
  async function loadVersion() {
    try {
      const r = await fetch(api('/version'));
      const j = await r.json();
      versionEl.textContent = `${j.app} v${j.version}`;
      setStatus('OK');
    } catch (e) {
      setStatus('Error loading version');
    }
  }
  function setStatus(text) {
    statusEl.textContent = text;
    statusEl.style.color = (text.toLowerCase().includes('error')) ? 'var(--bad)' : 'var(--good)';
  }
  async function loadQuote(sym) {
    try {
      const r = await fetch(api(`/quote/${encodeURIComponent(sym)}`));
      if (!r.ok) throw new Error('quote failed');
      const j = await r.json();
      statHigh.textContent = fmt(j.high);
      statLow.textContent  = fmt(j.low);
      statOpen.textContent = fmt(j.open);
      statClose.textContent= fmt(j.prev_close);
      return j;
    } catch (e) {
      statHigh.textContent = statLow.textContent = statOpen.textContent = statClose.textContent = '–';
      return null;
    }
  }
  async function loadSummary(sym) {
    try {
      const r = await fetch(api(`/summary/${encodeURIComponent(sym)}`));
      if (!r.ok) throw new Error('summary failed');
      const j = await r.json();
      summaryEl.textContent = j.summary || '—';
      return j;
    } catch (e) {
      summaryEl.textContent = '—';
      return null;
    }
  }
  async function loadHistory(sym, rangeKey) {
    try {
      const r = await fetch(api(`/history/${encodeURIComponent(sym)}?range=${rangeKey}`));
      if (!r.ok) throw new Error('history failed');
      const j = await r.json();
      return j.points || [];
    } catch (e) {
      return [];
    }
  }

  // ---------- Chart ----------
  function clearCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    // panel bg
    ctx.fillStyle = (theme === 'light') ? 'rgba(255,255,255,.65)' : 'rgba(2,12,30,.35)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  function drawLineChart(pts, animate=true) {
    clearCanvas();
    chartCache = null;

    // Handle empty or single-point data
    if (!pts || !pts.length) {
      drawEmpty();
      return;
    }

    const padX = 40, padY = 26;
    const w = canvas.width  - padX * 2;
    const h = canvas.height - padY * 2;

    const prices = pts.map(p => p.p);
    const min = Math.min(...prices);
    const max = Math.max(...prices);
    const span = (max - min) || 1;

    // Grid
    ctx.save();
    ctx.translate(padX, padY);
    ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--grid').trim();
    ctx.lineWidth = 1;
    // horizontal grid + labels
    ctx.font = '11px Inter, system-ui';
    ctx.fillStyle = (theme === 'light') ? '#475872' : '#93a1bd';
    ctx.textAlign = 'right';
    ctx.textBaseline = 'middle';
    const lines = 5;
    for (let i = 0; i <= lines; i++) {
      const y = Math.round(h - (h * i / lines)) + .5;
      ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y); ctx.stroke();
      const label = (min + (span * i / lines)).toFixed(2);
      ctx.fillText(label, -6, y);
    }
    // vertical ticks (dates)
    ctx.textAlign = 'center';
    ctx.textBaseline = 'top';
    const vTicks = Math.min(6, Math.max(3, Math.floor(pts.length / 10)));
    for (let i = 0; i <= vTicks; i++) {
      const x = Math.round(w * i / vTicks) + .5;
      ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, h); ctx.stroke();
      const idx = Math.round(pts.length * i / vTicks);
      const t = pts[Math.min(idx, pts.length - 1)].t;
      ctx.fillText(fmtShortDate(t), x, h + 6);
    }
    ctx.restore();

    // Line animate
    const color = getComputedStyle(document.documentElement).getPropertyValue('--chart').trim();
    const lineWidth = 2.5;

    // Precompute coords
    const coords = pts.map((p, i) => {
      const x = padX + (w * i / (pts.length - 1 || 1));
      const y = padY + (h - ((p.p - min) / span) * h);
      return { x, y, p: p.p, t: p.t };
    });

    // If only 1 point, draw a dot + baseline
    if (coords.length === 1) {
      const {x,y} = coords[0];
      ctx.beginPath();
      ctx.arc(x, y, 3.5, 0, Math.PI*2); ctx.fillStyle = color; ctx.fill();
      ctx.strokeStyle = color; ctx.lineWidth = lineWidth;
      ctx.beginPath(); ctx.moveTo(padX, y); ctx.lineTo(padX + w, y); ctx.stroke();
      chartCache = { padX, padY, w, h, coords, min, max, span };
      return;
    }

    // Animation
    let t0;
    cancelAnimationFrame(animReq);
    function frame(ts) {
      if (!t0) t0 = ts;
      const prog = Math.max(0, Math.min(1, (ts - t0) / 500)); // 0.5s

      clearCanvas();
      // redraw grid (cheap)
      ctx.save();
      ctx.translate(padX, padY);
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--grid').trim();
      ctx.lineWidth = 1;
      const lines = 5;
      for (let i = 0; i <= lines; i++) {
        const y = Math.round(h - (h * i / lines)) + .5;
        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y); ctx.stroke();
      }
      ctx.restore();

      // line
      ctx.strokeStyle = color;
      ctx.lineWidth = lineWidth;
      ctx.beginPath();
      coords.forEach((c, i) => {
        const toX = padX + (c.x - padX) * prog;
        const toY = padY + (c.y - padY) * prog;
        if (i === 0) ctx.moveTo(toX, toY);
        else ctx.lineTo(toX, toY);
      });
      ctx.stroke();

      if (prog < 1 && animate) animReq = requestAnimationFrame(frame);
    }
    animReq = requestAnimationFrame(frame);

    chartCache = { padX, padY, w, h, coords, min, max, span };
  }

  function drawEmpty() {
    ctx.save();
    ctx.globalAlpha = .9;
    ctx.fillStyle = (theme === 'light') ? '#6b7b9c' : '#9fb0d3';
    ctx.font = '600 13px Inter, system-ui';
    ctx.textAlign = 'center';
    ctx.fillText('No data', canvas.width/2, canvas.height/2);
    ctx.restore();
  }

  // Hover tooltip
  canvas.addEventListener('mousemove', (ev) => {
    if (!chartCache) { tooltip.style.display = 'none'; return; }
    const rect = canvas.getBoundingClientRect();
    const mx = ev.clientX - rect.left;
    const my = ev.clientY - rect.top;
    const { padX, padY, w, h, coords } = chartCache;

    // bounds
    if (mx < padX || mx > padX + w || my < padY || my > padY + h) {
      tooltip.style.display = 'none';
      return;
    }
    // nearest index by x
    const ratio = (mx - padX) / w;
    const idx = Math.max(0, Math.min(coords.length - 1, Math.round(ratio * (coords.length - 1))));
    const c = coords[idx];

    tooltip.style.display = 'block';
    tooltip.textContent = `${fmtDate(c.t)}   ${fmt(c.p)}`;
    const tw = tooltip.offsetWidth, th = tooltip.offsetHeight;
    let tx = c.x - tw/2, ty = c.y - th - 10;
    if (tx < 8) tx = 8;
    if (tx + tw > canvas.width - 8) tx = canvas.width - tw - 8;
    if (ty < 8) ty = c.y + 12;
    tooltip.style.left = tx + 'px';
    tooltip.style.top  = ty + 'px';
  });
  canvas.addEventListener('mouseleave', () => { tooltip.style.display = 'none'; });

  // ---------- UI Events ----------
  $$('.chip').forEach(ch => {
    ch.addEventListener('click', async () => {
      $$('.chip').forEach(c => c.classList.remove('active'));
      ch.classList.add('active');
      activeRange = ch.dataset.range;
      statusEl.textContent = `Loading ${activeRange}…`; statusEl.style.color = 'var(--muted)';
      await refreshAll();
    });
  });

  getBtn.addEventListener('click', async () => {
    await refreshAll();
  });
  refreshBtn.addEventListener('click', async () => {
    await refreshAll();
  });
  symbolInput.addEventListener('keydown', async (e) => {
    if (e.key === 'Enter') await refreshAll();
  });

  // ---------- Orchestrate ----------
  async function refreshAll() {
    const sym = (symbolInput.value || 'AAPL').trim().toUpperCase();
    symbolInput.value = sym;
    legendSym.textContent = sym;

    setStatus(`Loading ${activeRange}…`);
    const [_, __, points] = await Promise.all([
      loadQuote(sym),
      loadSummary(sym),
      loadHistory(sym, activeRange)
    ]);

    chartDataPoints = points;
    drawLineChart(points);

    // If we got points, OK; else show warning
    if (points && points.length) setStatus('OK'); else setStatus('No chart data');
  }

  // ---------- Init ----------
  (async function init() {
    await loadVersion();
    await refreshAll();
  })();
</script>
</body>
</html>


























