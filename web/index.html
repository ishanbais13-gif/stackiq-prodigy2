<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StackIQ – Live Stocks</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#eee; text-align:center; padding:20px; }
    h1 { color:#4cafef; }
    .card { background:#1b1b1b; padding:20px; border-radius:8px; display:inline-block; margin-top:20px; }
    label { display:block; margin-bottom:8px; font-weight:bold; }
    input { padding:8px; width:200px; }
    button { padding:8px 16px; margin-top:10px; background:#4cafef; border:none; color:#fff; cursor:pointer; border-radius:4px; }
    button:hover { background:#379bd8; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:20px; }
    .grid div { background:#222; padding:10px; border-radius:6px; }
    .hint { font-size:0.9em; margin-top:10px; color:#aaa; }
    .error { color:#ff6b6b; margin-top:10px; }
  </style>
</head>
<body>
  <h1>StackIQ</h1>
  <p id="apiStatus">Checking API...</p>

  <div class="card">
    <form id="tickerForm">
      <label for="ticker">Enter Stock Ticker:</label>
      <input id="ticker" name="ticker" placeholder="AAPL, MSFT, NVDA..." required />
      <button type="submit">Fetch</button>
    </form>
    <p class="hint">Tip: You can also open <code>/test/AAPL?pretty=1</code> directly in the browser.</p>
  </div>

  <div id="results" class="card hidden">
    <h2 id="title"></h2>
    <div class="grid">
      <div><strong>Current Price:</strong> <span id="c"></span></div>
      <div><strong>Change:</strong> <span id="d"></span></div>
      <div><strong>% Change:</strong> <span id="dp"></span></div>
      <div><strong>Open:</strong> <span id="o"></span></div>
      <div><strong>High:</strong> <span id="h"></span></div>
      <div><strong>Low:</strong> <span id="l"></span></div>
      <div><strong>Prev Close:</strong> <span id="pc"></span></div>
      <div><strong>Volume:</strong> <span id="volume"></span></div>
    </div>
    <div>
      <h3>Earnings</h3>
      <pre id="earnings"></pre>
    </div>
    <p class="error" id="error"></p>
  </div>

  <script>
    const BACKEND_URL = "https://stackiq-web-btbfdxekdfhrcaey.centralus-01.azurewebsites.net";

    async function checkAPI() {
      try {
        const res = await fetch(`${BACKEND_URL}/health`);
        if (res.ok) {
          document.getElementById("apiStatus").innerText = "✅ API is live";
        } else {
          document.getElementById("apiStatus").innerText = "⚠️ API issue";
        }
      } catch (err) {
        document.getElementById("apiStatus").innerText = "❌ Cannot reach API";
      }
    }

    document.getElementById("tickerForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const ticker = document.getElementById("ticker").value.trim().toUpperCase();
      const resultsDiv = document.getElementById("results");
      const errorDiv = document.getElementById("error");
      errorDiv.innerText = "";

      try {
        const res = await fetch(`${BACKEND_URL}/test/${ticker}?pretty=1`);
        if (!res.ok) throw new Error("Ticker not found");
        const data = await res.json();

        document.getElementById("title").innerText = `Results for ${ticker}`;
        document.getElementById("c").innerText = data.price?.c ?? "-";
        document.getElementById("d").innerText = data.price?.d ?? "-";
        document.getElementById("dp").innerText = data.price?.dp ?? "-";
        document.getElementById("o").innerText = data.price?.o ?? "-";
        document.getElementById("h").innerText = data.price?.h ?? "-";
        document.getElementById("l").innerText = data.price?.l ?? "-";
        document.getElementById("pc").innerText = data.price?.pc ?? "-";
        document.getElementById("volume").innerText = data.price?.volume ?? "-";
        document.getElementById("earnings").innerText = JSON.stringify(data.earnings?.earningsCalendar ?? [], null, 2);

        resultsDiv.classList.remove("hidden");
      } catch (err) {
        errorDiv.innerText = "Error: " + err.message;
      }
    });

    checkAPI();
  </script>
</body>
</html>


