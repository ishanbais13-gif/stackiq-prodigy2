<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1"
  />
  <title>StackIQ — minimal market data UI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <style>
    :root {
      --bg: #0b1320;
      --panel: #111a2e;
      --muted: #7f8ba6;
      --text: #e6ecff;
      --brand: #6aa3ff;
      --brand-2: #8c6bff;
      --success: #25d0a2;
      --danger: #ff7a7a;
      --shadow: 0 10px 40px rgba(0,0,0,.45);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      color: var(--text);
      background: radial-gradient(1200px 700px at 85% 20%, rgba(96, 70, 255, .20), transparent),
                  radial-gradient(900px 600px at 15% 10%, rgba(74, 168, 255, .18), transparent),
                  var(--bg);
    }
    .page {
      max-width: 1120px;
      margin: 48px auto 80px;
      padding: 0 20px;
    }
    header {
      display:flex; align-items:center; gap:14px; margin-bottom:18px;
    }
    .logo-dot {
      width: 18px; height: 18px; border-radius: 6px;
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      box-shadow: 0 6px 20px rgba(106,163,255,.35), inset 0 0 16px rgba(255,255,255,.18);
    }
    .brand { font-weight: 700; font-size: 22px; letter-spacing:.2px; }
    .sublabel { font-size: 12px; color: var(--muted); margin-left: 2px; }

    .grid {
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 26px;
    }
    @media (max-width: 980px) {
      .grid { grid-template-columns: 1fr; }
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border: 1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .pad { padding: 18px; }
    .row { display:flex; align-items:center; gap:10px; }
    .grow { flex: 1; }
    .muted { color: var(--muted); }

    .input {
      width: 100%; height: 42px; border-radius: 10px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.08);
      color: var(--text); padding: 0 14px; font-size:14px;
      outline: none;
    }
    .btn {
      height: 42px; padding: 0 14px; border-radius: 10px; border: 0; cursor: pointer;
      font-weight: 600; color: #0b1320; background: linear-gradient(135deg, var(--brand), var(--brand-2));
      box-shadow: 0 6px 22px rgba(106,163,255,.35);
    }
    .btn-ghost {
      height: 42px; padding: 0 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,.08); cursor: pointer;
      color: var(--text); background: rgba(255,255,255,.03);
    }

    .stats { display:grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
    @media (max-width: 640px) {
      .stats { grid-template-columns: repeat(2, 1fr); }
    }
    .stat {
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 12px; padding: 10px 12px;
    }
    .stat .label { font-size: 12px; color: var(--muted); margin-bottom: 4px; }
    .stat .val { font-size: 16px; font-weight: 700; letter-spacing:.2px; }

    .ranges { display:flex; gap: 8px; margin: 12px 0 2px; }
    .chip {
      padding: 6px 10px; border-radius: 999px;
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.08);
      color: var(--text); font-weight: 600; font-size: 12px; cursor: pointer;
    }
    .chip.active {
      background: rgba(106,163,255,.14);
      border-color: rgba(106,163,255,.45);
      box-shadow: inset 0 0 0 1px rgba(106,163,255,.3);
    }

    .chart-wrap { margin-top: 12px; border-radius: 14px; overflow: hidden; border:1px solid rgba(255,255,255,.06); }
    canvas { display:block; width: 100%; height: 300px; background: rgba(2,12,30,.45); }

    .aside .title { font-weight: 700; }
    .aside .kv { margin-top: 8px; }
    .kv .k { font-size:12px; color: var(--muted); }
    .kv .v { font-size:14px; font-weight: 600; }

    .api-note {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size: 12px; color: rgba(230,236,255,.6);
      margin: 10px 2px 0;
    }

    .tooltip {
      position: absolute;
      pointer-events:none;
      padding: 6px 8px;
      font-size: 12px;
      background: #0b1320;
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 6px;
      box-shadow: var(--shadow);
      color: var(--text);
      display:none;
      transform: translate(-50%, -120%);
      white-space: nowrap;
    }

    footer { text-align:center; color: var(--muted); font-size: 12px; margin-top: 16px; }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="logo-dot"></div>
      <div class="brand">StackIQ</div>
      <div class="sublabel">Minimal market data UI</div>
    </header>

    <div class="grid">
      <!-- LEFT: quote + chart -->
      <section class="card pad">
        <div class="row" style="gap:8px;">
          <input id="symbolInput" class="input grow" value="AAPL" spellcheck="false" />
          <button id="getBtn" class="btn">Get Quote</button>
          <button id="refreshBtn" class="btn-ghost" title="Refresh">⟳</button>
        </div>

        <div class="stats">
          <div class="stat"><div class="label">Session High</div><div id="statHigh" class="val">—</div></div>
          <div class="stat"><div class="label">Session Low</div><div id="statLow" class="val">—</div></div>
          <div class="stat"><div class="label">Open</div><div id="statOpen" class="val">—</div></div>
          <div class="stat"><div class="label">Prev Close</div><div id="statClose" class="val">—</div></div>
        </div>

        <div class="ranges">
          <button class="chip active" data-range="1M">1M</button>
          <button class="chip" data-range="3M">3M</button>
          <button class="chip" data-range="6M">6M</button>
          <button class="chip" data-range="1Y">1Y</button>
        </div>

        <div class="chart-wrap" style="position:relative;">
          <canvas id="chartCanvas" width="1000" height="300"></canvas>
          <div id="tooltip" class="tooltip"></div>
        </div>

        <div class="api-note">API: /quote/{symbol}, /summary/{symbol}, /history/{symbol}</div>
      </section>

      <!-- RIGHT: status -->
      <aside class="card pad aside">
        <div class="title muted">Status</div>
        <div id="status" class="kv"><span class="k">State:</span> <span class="v">Loading…</span></div>
        <div class="kv" style="margin-top:6px;"><span class="k">Version:</span> <span id="version" class="v">—</span></div>

        <div class="title muted" style="margin-top:16px;">Summary</div>
        <div id="summary" style="font-size:13px; line-height:1.5; margin-top:6px; color: #cdd6f4;">—</div>
      </aside>
    </div>

    <footer>© 2025 StackIQ</footer>
  </div>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    const statHigh  = $('#statHigh');
    const statLow   = $('#statLow');
    const statOpen  = $('#statOpen');
    const statClose = $('#statClose');

    const statusEl  = $('#status .v');
    const versionEl = $('#version');
    const summaryEl = $('#summary');

    const symbolInput = $('#symbolInput');
    const getBtn = $('#getBtn');
    const refreshBtn = $('#refreshBtn');

    const canvas = $('#chartCanvas');
    const ctx = canvas.getContext('2d');
    const tooltip = $('#tooltip');

    let activeRange = '1M';
    let points = []; // {t, c}
    let isLoading = false;

    const api = (p) => p;

    function fmt(n) {
      return (n === null || n === undefined || isNaN(n)) ? '—' : Number(n).toFixed(3);
    }
    function fmtDate(ts) {
      const d = new Date(ts * 1000);
      return d.toLocaleDateString(undefined, {year:'2-digit', month:'short', day:'2-digit'});
    }

    async function loadVersion() {
      try {
        const r = await fetch(api('/version'));
        const j = await r.json();
        versionEl.textContent = `${j.app} ${j.version}`;
        setStatus('Loaded.');
      } catch {
        setStatus('Error loading version');
      }
    }

    function setStatus(text) {
      statusEl.textContent = text;
    }

    async function loadQuote(sym) {
      try {
        const r = await fetch(api(`/quote/${encodeURIComponent(sym)}`));
        if (!r.ok) throw new Error('quote failed');
        const j = await r.json();
        statHigh.textContent  = fmt(j.high);
        statLow.textContent   = fmt(j.low);
        statOpen.textContent  = fmt(j.open);
        statClose.textContent = fmt(j.prev_close);
        return j;
      } catch {
        statHigh.textContent  = '—';
        statLow.textContent   = '—';
        statOpen.textContent  = '—';
        statClose.textContent = '—';
        return null;
      }
    }

    async function loadSummary(sym) {
      try {
        const r = await fetch(api(`/summary/${encodeURIComponent(sym)}`));
        if (!r.ok) throw new Error('summary failed');
        const j = await r.json();
        summaryEl.textContent = j.summary || '—';
      } catch {
        summaryEl.textContent = '—';
      }
    }

    async function loadHistory(sym, rangeKey) {
      try {
        const r = await fetch(api(`/history/${encodeURIComponent(sym)}?range=${rangeKey}`));
        if (!r.ok) throw new Error('history failed');
        const j = await r.json();
        return j.points || [];
      } catch {
        return [];
      }
    }

    // ----------------- Chart -----------------
    function clearCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = 'rgba(255,255,255,.02)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function drawLineChart(pts) {
      clearCanvas();
      if (!pts.length) return;

      const padX = 36, padY = 22;
      const w = canvas.width - padX * 2;
      const h = canvas.height - padY * 2;
      const min = Math.min(...pts.map(p => p.c));
      const max = Math.max(...pts.map(p => p.c));
      const span = (max - min) || 1;

      // grid
      ctx.strokeStyle = 'rgba(255,255,255,.06)';
      ctx.lineWidth = 1;
      for (let i = 0; i < 5; i++) {
        const y = padY + (h * i / 4);
        ctx.beginPath(); ctx.moveTo(padX, y); ctx.lineTo(padX + w, y); ctx.stroke();
      }

      // line
      ctx.beginPath();
      pts.forEach((p, i) => {
        const x = padX + (w * i / (pts.length - 1 || 1));
        const y = padY + h - ((p.c - min) / span) * h;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.strokeStyle = '#6aa3ff';
      ctx.lineWidth = 2.5;
      ctx.stroke();

      // save for hover
      canvas._chart = { padX, padY, w, h, min, max, span, pts };
    }

    function handleHover(ev) {
      const c = canvas._chart;
      if (!c) return;
      const rect = canvas.getBoundingClientRect();
      const mx = ev.clientX - rect.left;
      const my = ev.clientY - rect.top;

      // inside plot?
      if (mx < c.padX || mx > c.padX + c.w || my < c.padY || my > c.padY + c.h) {
        tooltip.style.display = 'none';
        return;
      }
      // find nearest index
      const ratio = (mx - c.padX) / c.w;
      const idx = Math.round(ratio * (c.pts.length - 1));
      const p = c.pts[Math.max(0, Math.min(c.pts.length - 1, idx))];

      const x = c.padX + (c.w * idx / (c.pts.length - 1 || 1));
      const y = c.padY + c.h - ((p.c - c.min) / c.span) * c.h;

      // vertical guide
      clearCanvas();
      drawLineChart(c.pts); // redraw line
      ctx.beginPath();
      ctx.moveTo(x, c.padY);
      ctx.lineTo(x, c.padY + c.h);
      ctx.strokeStyle = 'rgba(255,255,255,.15)';
      ctx.lineWidth = 1;
      ctx.stroke();

      // tooltip
      tooltip.style.display = 'block';
      tooltip.style.left = `${x}px`;
      tooltip.style.top = `${y}px`;
      tooltip.textContent = `${fmtDate(p.t)}  •  ${fmt(p.c)}`;
    }

    canvas.addEventListener('mousemove', handleHover);
    canvas.addEventListener('mouseleave', () => (tooltip.style.display = 'none'));

    // --------------- Orchestration ---------------
    async function refreshAll() {
      if (isLoading) return;
      isLoading = true;
      setStatus('Loading...');
      const sym = symbolInput.value.trim().toUpperCase() || 'AAPL';

      await loadVersion();
      await loadQuote(sym);
      await loadSummary(sym);

      const hist = await loadHistory(sym, activeRange);
      points = hist;
      drawLineChart(points);

      setStatus('Loaded.');
      isLoading = false;
    }

    // UI events
    getBtn.addEventListener('click', () => refreshAll());
    refreshBtn.addEventListener('click', () => refreshAll());
    symbolInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') refreshAll();
    });

    $$('.chip').forEach(btn => {
      btn.addEventListener('click', async () => {
        $$('.chip').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        activeRange = btn.dataset.range;
        await refreshAll();
      });
    });

    // First load
    refreshAll();
    // Optional auto-refresh every 90s
    setInterval(refreshAll, 90000);
  </script>
</body>
</html>

















