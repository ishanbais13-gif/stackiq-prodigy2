<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>StackIQ â€” Live Quote</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --card:#0b1220; --text:#e5e7eb; --muted:#9ca3af; --brand:#2563eb; --good:#16a34a; --bad:#ef4444; --ring:#1f2937; --line:#334155;
      --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    :root.light{
      --bg:#f6f7fb; --panel:#ffffff; --card:#ffffff; --text:#0f172a; --muted:#6b7280; --brand:#2563eb; --good:#16a34a; --bad:#dc2626; --ring:#e5e7eb; --line:#d1d5db;
      --shadow:0 10px 24px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
    .wrap{max-width:1100px;margin:48px auto;padding:0 20px}
    .brand{font-weight:800;letter-spacing:.3px;margin-bottom:18px}
    .row{display:grid;grid-template-columns:1fr 360px;gap:24px}
    .panel{background:var(--panel);border-radius:16px;box-shadow:var(--shadow);padding:20px;border:1px solid var(--ring)}
    .inputbar{display:flex;gap:12px;align-items:center;margin-bottom:16px}
    input[type=text]{flex:1;border:1px solid var(--ring);background:var(--card);color:var(--text);border-radius:999px;padding:12px 16px;outline:none}
    button.primary{border:none;background:var(--brand);color:#fff;border-radius:999px;padding:12px 16px;cursor:pointer}
    .toggle{width:32px;height:32px;border-radius:50%;border:1px solid var(--ring);background:var(--card);display:inline-grid;place-items:center;cursor:pointer}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:18px 0}
    .stat{border:1px solid var(--ring);border-radius:10px;padding:12px}
    .big{font-size:44px;font-weight:800;letter-spacing:.5px;margin:12px 0}
    .chip{display:inline-flex;gap:6px;align-items:center;font-size:12px;padding:4px 8px;border-radius:999px;background:rgba(37,99,235,.12);border:1px solid var(--ring);color:var(--text)}
    .muted{color:var(--muted)}
    canvas{width:100%;height:280px}
    .footer{margin-top:10px;font-size:12px;color:var(--muted)}
    a{color:var(--brand);text-decoration:none}
    @media (max-width:980px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="brand">StackIQ</div>

    <div class="inputbar">
      <input id="symbol" type="text" placeholder="AAPL" value="AAPL" />
      <button id="go" class="primary">Get Quote</button>
      <div id="theme" class="toggle" title="Toggle theme">ðŸŒ—</div>
    </div>

    <div class="row">
      <div class="panel">
        <div class="card">
          <div style="display:flex;align-items:center;gap:10px;">
            <div id="sym" style="font-weight:800;font-size:24px;">â€”</div>
            <span id="delta" class="chip muted">â€”</span>
          </div>
          <div id="price" class="big">â€”</div>

          <div class="grid">
            <div class="stat">
              <div class="muted" style="font-size:12px;">Session High</div>
              <div id="hi" style="font-weight:700;">â€”</div>
            </div>
            <div class="stat">
              <div class="muted" style="font-size:12px;">Session Low</div>
              <div id="lo" style="font-weight:700;">â€”</div>
            </div>
            <div class="stat">
              <div class="muted" style="font-size:12px;">Open</div>
              <div id="open" style="font-weight:700;">â€”</div>
            </div>
            <div class="stat">
              <div class="muted" style="font-size:12px;">Prev Close</div>
              <div id="pc" style="font-weight:700;">â€”</div>
            </div>
          </div>

          <div id="blurb" class="muted" style="margin-top:6px;">â€”</div>

          <div style="display:flex;gap:8px;margin:14px 0;">
            <button class="primary" data-range="1m" style="background:transparent;color:var(--text);border:1px solid var(--ring)">1M</button>
            <button class="primary" data-range="3m" style="background:var(--brand);">3M</button>
            <button class="primary" data-range="6m" style="background:transparent;color:var(--text);border:1px solid var(--ring)">6M</button>
            <button class="primary" data-range="1y" style="background:transparent;color:var(--text);border:1px solid var(--ring)">1Y</button>
          </div>

          <canvas id="chart"></canvas>

          <div class="footer">
            API: <code>/quote/{symbol}</code>, <code>/summary/{symbol}</code>
          </div>
        </div>
      </div>

      <div class="panel">
        <div class="card">
          <div style="font-weight:800;margin-bottom:6px;">Status</div>
          <div class="muted" id="status">Loadingâ€¦</div>
          <div class="muted" id="ver" style="margin-top:8px;"></div>
        </div>
      </div>
    </div>

    <div class="footer">Â© 2025 StackIQ â€¢ minimal market data UI</div>
  </div>

  <script>
    // Theme toggle (persists)
    const root = document.documentElement;
    const themeBtn = document.getElementById('theme');
    const saved = localStorage.getItem('theme') || 'light';
    if (saved === 'light') root.classList.add('light'); else root.classList.remove('light');
    themeBtn.onclick = () => {
      const isLight = root.classList.toggle('light');
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
    };

    // Basic line chart (no libs)
    const ctx = document.getElementById('chart').getContext('2d');
    function drawChart(points) {
      const w = ctx.canvas.width = ctx.canvas.clientWidth * window.devicePixelRatio;
      const h = ctx.canvas.height = ctx.canvas.clientHeight * window.devicePixelRatio;
      ctx.clearRect(0,0,w,h);
      ctx.lineWidth = 2; ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--brand').trim();
      const xs = points.map((_,i)=> i/(points.length-1));
      const min = Math.min(...points), max = Math.max(...points);
      const ys = points.map(v => (1-(v-min)/(max-min+1e-9)) * (h-20) + 10);
      ctx.beginPath();
      xs.forEach((x,i)=>{
        const px = 20 + x*(w-40);
        const py = ys[i];
        if (i===0) ctx.moveTo(px,py); else ctx.lineTo(px,py);
      });
      ctx.stroke();
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--line').trim();
      ctx.lineWidth = 1; ctx.strokeRect(20,10,w-40,h-20);
    }
    const mock = (n, base=150) => Array.from({length:n},(_,i)=> base + Math.sin(i/4)*5 + Math.random()*3);

    // UI bits
    const $ = id => document.getElementById(id);
    const symInp = $('symbol'), goBtn = $('go');
    const fields = { sym:$('sym'), delta:$('delta'), price:$('price'), hi:$('hi'), lo:$('lo'), open:$('open'), pc:$('pc'), blurb:$('blurb'), status:$('status'), ver:$('ver') };

    async function loadStatus() {
      try {
        const h = await fetch('/health').then(r=>r.json());
        fields.status.textContent = h.status === 'ok' ? 'Loaded.' : 'Loadingâ€¦';
      } catch { fields.status.textContent = 'Unavailable'; }
      try {
        const v = await fetch('/version').then(r=>r.json());
        fields.ver.textContent = `Version: ${v.app} ${v.version}`;
      } catch { fields.ver.textContent = ''; }
    }

    async function loadQuote(symbol) {
      const s = (symbol||'').trim();
      if (!s) return;
      try {
        const q = await fetch(`/quote/${encodeURIComponent(s)}`).then(r=>{
          if (!r.ok) throw new Error(`Failed to load quote: /quote/${s} -> ${r.status}`);
          return r.json();
        });
        const up = (q.percent_change||0) >= 0;
        fields.sym.textContent = q.symbol;
        fields.price.textContent = q.current.toFixed(3);
        fields.hi.textContent = q.high.toFixed(2);
        fields.lo.textContent = q.low.toFixed(2);
        fields.open.textContent = q.open.toFixed(2);
        fields.pc.textContent = q.prev_close.toFixed(2);
        fields.delta.textContent = `${up? 'â–²':'â–¼'} ${Math.abs(q.percent_change).toFixed(2)}%`;
        fields.delta.style.background = `rgba(${up?'22,163,74':'239,68,68'},.15)`;
        fields.delta.style.borderColor = 'var(--ring)';
        fields.blurb.textContent = `${q.symbol}: ${q.current} (${up?'up':'down'} ${Math.abs(q.percent_change).toFixed(2)}% on the day). `
          + `Session range: ${q.low}â€“${q.high}. Prev close: ${q.prev_close}.`;
      } catch (e) {
        fields.blurb.textContent = String(e.message || e);
        fields.price.textContent = 'â€”';
        fields.hi.textContent = fields.lo.textContent = fields.open.textContent = fields.pc.textContent = 'â€”';
        fields.delta.textContent = 'â€”';
      }
    }

    function setRange(n){ drawChart(mock(42, 150 + (Math.random()*6-3))); }
    document.querySelectorAll('button[data-range]').forEach(b=> b.onclick = ()=> setRange(b.dataset.range));

    goBtn.onclick = () => loadQuote(symInp.value);
    symInp.addEventListener('keydown', e => { if (e.key === 'Enter') loadQuote(symInp.value); });

    // initial
    loadStatus();
    setRange('3m');
    loadQuote(symInp.value);
  </script>
</body>
</html>










